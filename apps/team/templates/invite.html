{% extends 'core/base.html' %}

{% block title %}Invite | {% endblock %}

{% block content %}

<nav class="breadcrumb" aira-label="breadcrumbs">
  <ul>
    <li><a href="#">Dashboard</a></li>
    <li><a href="{% url 'myaccount' %}">My account</a></li>
    <li><a href="{% url 'team:team' team.id %}" aria-current="page">{{team.title}}</a></li>
    <li class="active"><a href="{% url 'team:invite' %}" aria-current="page">Invite Member</a></li>
  </ul>
</nav>

<div class="columns is-multiline" id="invite-app">
  <div class="column is-4">
    <h1 class="title">Invite member</h1>

    <div class="notification is-danger" v-if="errors.length">
      <p v-for="error in errors">[[ error ]]</p>
    </div>

    {% if team.plan.max_members_per_team > team.members.count %}
    <form method="post" action="." @submit="validateForm" novalidate>
      {% csrf_token %}
      <div class="field">
        <label for="id_email">E-mail</label>
        <div class="control">
          <input type="email" name="email" id="id_email" v-model="email" class="input" placeholder="user@domain.tld">
        </div>
      </div>
      <div class=" field">
        <div class="control">
          <button class="button is-success">Send invitation</button>
        </div>
      </div>
    </form>
    {% else %}
    Contact your team owner for more members.
    {% endif %}

  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const InviteApp = {
    data() {
      return {
        email: '',
        errors: [],
      }
    },
    delimiters: ['[[', ']]'],
    methods: {
      validateForm(e) {
        if (this.validateEmail(this.email)) {
          return true;
        }

        this.errors = ['The e-mail is not valid.'];

        e.preventDefault();
        return false;
      },
      validateEmail(email) {
        const pattern = /(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/;
        return pattern.test(email)
      }
    },
  };

  Vue.createApp(InviteApp).mount('#invite-app');
</script>
{% endblock %}
